function []= Plot_VulnerabilityCurves_Component(IMpoints,DEAGG_DATA,MAF,VC_Option,UnitOption,Replacement_Cost,C_Data,COMPDATA,N_Story)

%MAF=MAF';
MAF(end,:)=[];

if UnitOption==1
    NormVal=10^6;
    label='Loss [M$]';
else
    NormVal=Replacement_Cost/100;    
    label='Loss [% \itCost\rm]';
end

if VC_Option==1
    X_parameter=IMpoints;
else
    X_parameter=MAF;
end

% Get the unique SC IDs
CIDs = unique(C_Data(:,1));

% Loop over the components
for Ci=1:size(CIDs,1)
    clear costx;
    costx=zeros(length(IMpoints),1);
    Ci_id=CIDs(Ci,1);                                                   % Get the component ID
    Ci_ShorterName(Ci,1)=COMPDATA.C_shortername(CIDs(Ci,1));            % Get the shortname of the component
    % Loop over all IMs
    for im=1:length(IMpoints)
        % Loop over the size of the DEAGG losses matrix (IM x Nstory x Ncomponents)
        for j=1:size(DEAGG_DATA,1)
            % If at the target IM and the target Component, save and add the loss data
            if DEAGG_DATA(j,1)==im && DEAGG_DATA(j,3)==Ci_id
                costx(im,1)=costx(im,1)+DEAGG_DATA(j,4); % save the repair loss value
            end
        end
    end
    evalc(strcat('cost.C',num2str(Ci_id),'=costx'));
end
Clabel=unique(Ci_ShorterName(:,1),'stable');

counter=0;
CheckedC(1,1)="-";
for Ci=1:size(CIDs,1)
    Ci_id=CIDs(Ci,1);
    if size(CIDs,1)>1 && Ci_id ~= size(CIDs,1) && sum(ismember(CheckedC,Ci_ShorterName(Ci,1)))==0
        counter=counter+1;
        Ci_id_uniquename(counter,1)=Ci_id;
        CheckedC(counter,1)=Ci_ShorterName(Ci,1);
        for Cii=Ci+1:size(CIDs,1)
            Cii_id=CIDs(Cii,1);
            if Ci_ShorterName(Cii,1)==Ci_ShorterName(Ci,1)
                evalc(strcat('cost.C',num2str(Ci_id),'=cost.C',num2str(Ci_id),'+ cost.C',num2str(Cii_id)));    
            end
        end
    end
end

figure('Color','w','Position', [500 300 450 350]); 
grid on; box on; hold on;
set(gca, 'fontname', 'Courier', 'fontsize',18);
nCi=size(Ci_id_uniquename,1);
for Ci=1:nCi
    Ci_id=Ci_id_uniquename(Ci,1);
    evalc(strcat('costx=cost.C',num2str(Ci_id)));    
    plot(X_parameter,costx/NormVal,'linewidth',1.5);
end
legend1=legend(Clabel);

ylabel (label,'fontsize',18);
if VC_Option==1
    xlabel ('IM [g]','fontsize',18);
    set(gca,'Xlim',[0.0 max(IMpoints)]);
    set(legend1,'fontname', 'Courier', 'fontsize',10,'Location','SouthEast');
else
    xlabel ('MAFE [1/year]','fontsize',18);
    set(gca,'Xlim',[0.0000001 1]);
    xticks([0.000001 0.0001 0.01 1.0]);
    set(gca, 'XScale', 'log')   
    set(legend1,'fontname', 'Courier', 'fontsize',10,'Location','NorthEast');
end

end
